<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SuperLista</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  max-width: 500px;
  margin: 0 auto;
  font-family: "Segoe UI", Roboto, sans-serif;
  transition: background 0.3s, color 0.3s;
}
header {
  background: linear-gradient(90deg, #4cafef, #43d497);
  color: white;
  text-align: center;
  padding: 12px;
  border-radius: 0 0 16px 16px;
  margin-bottom: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
header h1 { margin: 0; font-size: 1.5rem; }
.slide { display: none; }
.slide.active { display: block; animation: fadeIn 0.4s; }
@keyframes fadeIn { from {opacity:0} to {opacity:1} }

.card-custom {
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  padding: 15px;
  margin-bottom: 12px;
  background: white;
  transition: transform 0.2s;
}
.card-custom:hover { transform: scale(1.01); }

#nav-tabs {
  display: flex;
  justify-content: space-around;
  background: #f1f1f1;
  padding: 8px;
  border-radius: 12px;
  margin-bottom: 15px;
}
#nav-tabs button {
  flex: 1;
  margin: 0 4px;
  font-size: 1.2rem;
}
.mode-toggle { cursor:pointer; padding:8px 12px; border-radius:6px; border:1px solid #ccc; margin-right:6px; }
.mode-toggle.active { background:#43d497; color:white; border:none; }

body.bg-dark .card-custom { background:#2c2c2c; color:white; }
body.bg-dark header { background: linear-gradient(90deg, #333, #555); }
</style>
</head>
<body class="bg-light text-dark">

<header>
  <h1>üõçÔ∏è SuperLista</h1>
  <p class="small">Tu comparador de supermercados</p>
</header>

<div class="container">

  <!-- Navegaci√≥n -->
  <div id="nav-tabs">
    <button class="btn btn-outline-primary" data-slide="lista">üõí</button>
    <button class="btn btn-outline-success" data-slide="precios">üí∞</button>
    <button class="btn btn-outline-secondary" data-slide="ajustes">‚öôÔ∏è</button>
  </div>

  <!-- Lista -->
  <div id="slide-lista" class="slide active">
    <div class="card-custom">
      <h5>A√±adir producto</h5>
      <label for="group-select" class="form-label">Grupo</label>
      <select id="group-select" class="form-select mb-2"></select>

      <label for="product-select" class="form-label">Producto</label>
      <select id="product-select" class="form-select mb-2"></select>

      <label for="product-qty" class="form-label">Cantidad</label>
      <input type="number" min="1" value="1" id="product-qty" class="form-control mb-3">

      <button id="add-to-list" class="btn btn-primary w-100">A√±adir</button>
    </div>

    <div class="card-custom">
      <h5>Mi lista</h5>
      <div id="shopping-list-display"></div>
      <div class="d-flex gap-2 mt-2">
        <button id="compare" class="btn btn-success flex-fill">Comparar</button>
        <button id="clear-list-btn" class="btn btn-danger flex-fill">Vaciar</button>
      </div>
    </div>

    <div id="results-area"></div>
  </div>

  <!-- Precios -->
  <div id="slide-precios" class="slide">
    <div class="card-custom">
      <h5>Actualizar precios</h5>
      <label for="price-group-select" class="form-label">Grupo</label>
      <select id="price-group-select" class="form-select mb-2"></select>

      <label for="price-product-select" class="form-label">Producto</label>
      <select id="price-product-select" class="form-select mb-2"></select>

      <label for="price-super-select" class="form-label">Supermercado</label>
      <select id="price-super-select" class="form-select mb-2"></select>

      <label for="price-value" class="form-label">Precio</label>
      <input id="price-value" type="number" step="0.01" class="form-control mb-3">

      <button id="add-price" class="btn btn-primary w-100">Guardar precio</button>
    </div>

    <div class="card-custom">
      <h5>Lista de precios</h5>
      <div id="price-list"></div>
    </div>
  </div>

  <!-- Ajustes -->
  <div id="slide-ajustes" class="slide">
    <div class="card-custom">
      <h5>Supermercados disponibles</h5>
      <p class="small">Marca solo los supermercados a los que puedes ir.</p>
      <div id="supermarket-options"></div>
    </div>

    <div class="card-custom">
      <h5>Modo visual</h5>
      <div class="d-flex gap-2">
        <div id="mode-day" class="mode-toggle active">‚òÄÔ∏è D√≠a</div>
        <div id="mode-night" class="mode-toggle">üåô Noche</div>
      </div>
    </div>
  </div>

</div>

<!-- SCRIPT FUNCIONAL -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- Datos iniciales ---
  const data = {
    supermarkets: ['Mercadona','Carrefour','Lidl'],
    groups: {
      'L√°cteos': {
        'leche1l': { name:'Leche 1L', prices:{ 'Mercadona':0.95, 'Carrefour':1.05, 'Lidl':0.89 } },
        'yogurpack': { name:'Pack Yogures', prices:{ 'Mercadona':1.50, 'Carrefour':1.60 } }
      },
      'Panader√≠a': {
        'panmolde': { name:'Pan de molde', prices:{ 'Mercadona':1.25, 'Carrefour':1.30 } }
      },
      'Huevos': {
        'huevos12': { name:'Huevos 12', prices:{ 'Mercadona':2.10, 'Lidl':1.99 } }
      }
    }
  };

  let shoppingList = [];
  let enabledSupers = new Set(data.supermarkets);

  function money(n){ return (Number(n)||0).toFixed(2)+' ‚Ç¨'; }

  // --- Navegaci√≥n ---
  document.querySelectorAll('#nav-tabs button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('.slide').forEach(s=>s.classList.remove('active'));
      document.getElementById('slide-'+btn.dataset.slide).classList.add('active');
    });
  });

  // --- Renders ---
  function renderGroupSelects(){
    const gs=document.getElementById('group-select');
    const pg=document.getElementById('price-group-select');
    gs.innerHTML=''; pg.innerHTML='';
    Object.keys(data.groups).forEach(g=>{
      gs.innerHTML+=`<option value="${g}">${g}</option>`;
      pg.innerHTML+=`<option value="${g}">${g}</option>`;
    });
    renderProductSelect(gs.value);
    renderPriceProductSelect(pg.value);
  }
  function renderProductSelect(group){
    const ps=document.getElementById('product-select');
    ps.innerHTML='';
    Object.entries(data.groups[group]).sort((a,b)=>a[1].name.localeCompare(b[1].name))
      .forEach(([k,v])=> ps.innerHTML+=`<option value="${k}">${v.name}</option>`);
  }
  function renderPriceProductSelect(group){
    const ps=document.getElementById('price-product-select');
    ps.innerHTML='';
    Object.entries(data.groups[group]).sort((a,b)=>a[1].name.localeCompare(b[1].name))
      .forEach(([k,v])=> ps.innerHTML+=`<option value="${k}">${v.name}</option>`);
  }
  function renderSuperSelect(){
    const sel=document.getElementById('price-super-select');
    sel.innerHTML='';
    data.supermarkets.forEach(s=> sel.innerHTML+=`<option>${s}</option>`);
  }
  function renderPriceList(){
    const div=document.getElementById('price-list');
    let html='';
    Object.keys(data.groups).forEach(group=>{
      html+=`<h6 class="mt-2">${group}</h6>`;
      html+='<table class="table table-sm"><tr><th>Producto</th>'+data.supermarkets.map(s=>`<th>${s}</th>`).join('')+'</tr>';
      Object.values(data.groups[group]).sort((a,b)=>a.name.localeCompare(b.name)).forEach(p=>{
        html+='<tr><td>'+p.name+'</td>';
        data.supermarkets.forEach(s=>{
          html+='<td>'+(p.prices[s]!=null?money(p.prices[s]):'-')+'</td>';
        });
        html+='</tr>';
      });
      html+='</table>';
    });
    div.innerHTML=html;
  }
  function renderShoppingList(){
    const div=document.getElementById('shopping-list-display');
    if(shoppingList.length===0){ div.innerHTML='<em>No hay productos.</em>'; return; }
    let html='<ul>';
    shoppingList.forEach((it,i)=> html+=`<li>${it.name} √ó ${it.qty} <button data-idx="${i}" class="btn btn-sm btn-outline-danger">‚ùå</button></li>`);
    html+='</ul>';
    div.innerHTML=html;
  }
  function renderSuperOptions(){
    const div=document.getElementById('supermarket-options');
    div.innerHTML='';
    data.supermarkets.forEach(s=>{
      const checked=enabledSupers.has(s)?'checked':'';
      div.innerHTML+=`<div><label><input type="checkbox" value="${s}" ${checked}> ${s}</label></div>`;
    });
    div.querySelectorAll('input[type=checkbox]').forEach(chk=>{
      chk.onchange=()=>{ if(chk.checked) enabledSupers.add(chk.value); else enabledSupers.delete(chk.value); };
    });
  }

  // --- Eventos ---
  document.getElementById('group-select').onchange=ev=> renderProductSelect(ev.target.value);
  document.getElementById('price-group-select').onchange=ev=> renderPriceProductSelect(ev.target.value);

  document.getElementById('add-to-list').onclick=()=>{
    const group=document.getElementById('group-select').value;
    const key=document.getElementById('product-select').value;
    const qty=Math.max(1,parseInt(document.getElementById('product-qty').value)||1);
    const prod=data.groups[group][key];
    const existing=shoppingList.find(i=>i.key===key);
    if(existing) existing.qty+=qty; else shoppingList.push({key, name:prod.name, qty});
    renderShoppingList();
  };
  document.getElementById('shopping-list-display').onclick=(ev)=>{
    if(ev.target.dataset.idx!=null){
      shoppingList.splice(ev.target.dataset.idx,1);
      renderShoppingList();
    }
  };
  document.getElementById('clear-list-btn').onclick=()=>{ shoppingList=[]; renderShoppingList(); document.getElementById('results-area').innerHTML=''; };

  document.getElementById('add-price').onclick=()=>{
    const g=document.getElementById('price-group-select').value;
    const k=document.getElementById('price-product-select').value;
    const s=document.getElementById('price-super-select').value;
    const val=Number(document.getElementById('price-value').value);
    if(!val||val<=0) return alert('Precio inv√°lido');
    data.groups[g][k].prices[s]=val;
    renderPriceList();
  };

  document.getElementById('compare').onclick=()=>{
    if(shoppingList.length===0) return alert('A√±ade productos.');
    const activeSupers=Array.from(enabledSupers);
    const results=[]; const plan={};
    const singleTotals={};
    activeSupers.forEach(s=> singleTotals[s]={ok:true,total:0,missing:[]});

    shoppingList.forEach(item=>{
      let best=Infinity,bestSup=null;
      activeSupers.forEach(s=>{
        for(const g in data.groups){
          if(data.groups[g][item.key]){
            const unit=data.groups[g][item.key].prices[s];
            if(unit!=null){
              const total=unit*item.qty;
              if(total<best){ best=total; bestSup=s; }
              singleTotals[s].total+=total;
            } else { singleTotals[s].ok=false; singleTotals[s].missing.push(item.name); }
          }
        }
      });
      if(bestSup){
        results.push({name:item.name, qty:item.qty, bestSup, best});
        if(!plan[bestSup]) plan[bestSup]={items:[], total:0};
        plan[bestSup].items.push({name:item.name, qty:item.qty, total:best});
        plan[bestSup].total+=best;
      } else results.push({name:item.name, qty:item.qty, bestSup:null});
    });

    let html='<div class="card-custom"><h5>Por producto</h5><table class="table table-sm"><tr><th>Producto</th><th>Cant.</th><th>Mejor</th><th>Total</th></tr>';
    results.forEach(r=>{
      if(!r.bestSup) html+=`<tr><td>${r.name}</td><td>${r.qty}</td><td colspan=2>‚ùå Sin precio</td></tr>`;
      else html+=`<tr><td>${r.name}</td><td>${r.qty}</td><td>${r.bestSup}</td><td>${money(r.best)}</td></tr>`;
    });
    html+='</table></div>';

    html+='<div class="card-custom"><h5>Plan optimizado</h5>';
    let grand=0;
    for(const s in plan){ grand+=plan[s].total;
      html+=`<p><strong>${s}</strong> ‚Äî ${money(plan[s].total)}</p><ul>`;
      plan[s].items.forEach(it=> html+=`<li>${it.name} √ó ${it.qty} ‚Üí ${money(it.total)}</li>`);
      html+='</ul>';
    }
    html+=`<p><strong>Total global: ${money(grand)}</strong></p></div>`;

    html+='<div class="card-custom"><h5>Si compras TODO en un solo super</h5>';
    activeSupers.forEach(s=>{
      if(singleTotals[s].ok) html+=`<p><strong>${s}</strong>: ${money(singleTotals[s].total)}</p>`;
      else html+=`<p><strong>${s}</strong>: incompleto (faltan: ${singleTotals[s].missing.join(', ')})</p>`;
    });
    html+='</div>';

    document.getElementById('results-area').innerHTML=html;
  };

  // --- Modo visual ---
  const dayBtn=document.getElementById('mode-day');
  const nightBtn=document.getElementById('mode-night');
  function setMode(day){
    if(day){ document.body.className='bg-light text-dark'; dayBtn.classList.add('active'); nightBtn.classList.remove('active'); }
    else{ document.body.className='bg-dark text-light'; nightBtn.classList.add('active'); dayBtn.classList.remove('active'); }
  }
  dayBtn.onclick=()=>setMode(true);
  nightBtn.onclick=()=>setMode(false);

  // Init
  renderGroupSelects();
  renderSuperSelect();
  renderPriceList();
  renderShoppingList();
  renderSuperOptions();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
